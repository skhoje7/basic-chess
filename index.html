<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Basic Chess</title>
  <style>
    :root { --light:#f0d9b5; --dark:#b58863; --accent:#3b82f6; --select:#f59e0b; }
    body { margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:#0b2545; color:#fff; display:flex; align-items:center; justify-content:center; min-height:100vh; }
    .app { display:grid; gap:16px; align-items:center; justify-items:center; }
    .topbar { display:flex; gap:12px; align-items:center; }
    .btn { background:#111827; border:1px solid #374151; padding:.5rem .75rem; border-radius:.6rem; color:#fff; cursor:pointer; }
    .board { display:grid; grid-template-columns: repeat(8, 70px); grid-template-rows: repeat(8, 70px);
      border:6px solid #111827; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.4); background:#111827; }
    .sq { display:flex; align-items:center; justify-content:center; font-size:40px; user-select:none; position:relative; }
    .light { background:var(--light); color:#111; }
    .dark { background:var(--dark); color:#111; }
    .sq.select { outline:4px solid var(--select); outline-offset:-4px; }
    .sq.target::before { content:""; width:18px; height:18px; border-radius:50%; background:rgba(59,130,246,.85); }
    @media (max-width: 640px) {
      .board { grid-template-columns: repeat(8, 44px); grid-template-rows: repeat(8, 44px); }
      .sq { font-size:26px; }
    }
    noscript { background:#111827; padding:8px 12px; border-radius:8px; }
  </style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <button id="reset" class="btn">♻️ Reset</button>
      <div id="turn">Turn: White</div>
    </div>
    <div id="board" class="board" aria-label="Chess board"></div>
    <noscript>Enable JavaScript to see the chess board.</noscript>
  </div>

  <script>
    // Avoid modern syntax features so older browsers don’t choke.
    var PIECES = {
      w: { K:"♔", Q:"♕", R:"♖", B:"♗", N:"♘", P:"♙" },
      b: { K:"♚", Q:"♛", R:"♜", B:"♝", N:"♞", P:"♟" }
    };

    var board = [];        // 8x8 or null
    var current = 'w';
    var selected = null;   // {r:?, c:?}
    var targets = {};      // plain object as a set: key "r,c" -> true

    var boardEl = null, turnEl = null;

    function init() {
      boardEl = document.getElementById('board');
      turnEl  = document.getElementById('turn');
      document.getElementById('reset').addEventListener('click', setup);

      setup();
    }

    function setup() {
      board = emptyBoard();
      placeStartPosition();
      current = 'w';
      selected = null;
      targets = {};
      render();
    }

    function emptyBoard() {
      var a = [];
      for (var r=0;r<8;r++){
        var row = [];
        for (var c=0;c<8;c++) row.push(null);
        a.push(row);
      }
      return a;
    }

    function placeStartPosition(){
      var back = ["R","N","B","Q","K","B","N","R"];
      for (var c=0;c<8;c++){ board[0][c]={t:back[c],c:'b'}; board[7][c]={t:back[c],c:'w'}; }
      for (var c2=0;c2<8;c2++){ board[1][c2]={t:"P",c:'b'}; board[6][c2]={t:"P",c:'w'}; }
    }

    function render(){
      boardEl.innerHTML = '';
      for (var r=0;r<8;r++){
        for (var c=0;c<8;c++){
          var btn = document.createElement('button');
          btn.className = 'sq ' + ((r+c)%2 ? 'dark' : 'light');
          btn.setAttribute('data-r', r);
          btn.setAttribute('data-c', c);

          var piece = board[r][c];
          if (piece) btn.textContent = PIECES[piece.c][piece.t];

          if (selected && selected.r===r && selected.c===c) btn.className += ' select';
          if (targets[r+','+c]) btn.className += ' target';

          btn.onclick = (function(rr,cc){ return function(){ onSquare(rr,cc); }; })(r,c);
          boardEl.appendChild(btn);
        }
      }
      turnEl.textContent = 'Turn: ' + (current==='w'?'White':'Black');
    }

    function onSquare(r,c){
      var piece = board[r][c];

      // select own piece
      if (piece && piece.c===current){
        selected = {r:r, c:c};
        targets = legalMoves(r,c);
        render();
        return;
      }
      // move to target
      if (selected && targets[r+','+c]){
        move(selected.r, selected.c, r, c);
        selected = null; targets = {};
        current = (current==='w'?'b':'w');
        render();
        return;
      }
      // clear selection
      selected = null; targets = {}; render();
    }

    function move(r1,c1,r2,c2){
      var piece = board[r1][c1];
      board[r2][c2] = piece;
      board[r1][c1] = null;
      // simple promotion
      if (piece.t === 'P') {
        if (piece.c==='w' && r2===0) board[r2][c2] = {t:'Q', c:'w'};
        if (piece.c==='b' && r2===7) board[r2][c2] = {t:'Q', c:'b'};
      }
    }

    function legalMoves(r,c){
      var piece = board[r][c];
      var out = {};
      if (!piece) return out;

      function add(rr,cc){
        if (rr<0||rr>7||cc<0||cc>7) return false;
        var occ = board[rr][cc];
        if (!occ){ out[rr+','+cc] = true; return true; }
        if (occ.c!==piece.c){ out[rr+','+cc] = true; }
        return false;
      }

      function rays(dirs){
        for (var i=0;i<dirs.length;i++){
          var dr=dirs[i][0], dc=dirs[i][1], rr=r+dr, cc=c+dc;
          while (add(rr,cc)) { rr+=dr; cc+=dc; }
        }
      }

      if (piece.t==='P'){
        var dir = (piece.c==='w') ? -1 : 1;
        var start = (piece.c==='w') ? 6 : 1;

        // one forward
        if (inb(r+dir,c) && board[r+dir][c]===null) out[(r+dir)+','+c] = true;
        // two from start
        if (r===start && board[r+dir][c]===null && inb(r+2*dir,c) && board[r+2*dir][c]===null)
          out[(r+2*dir)+','+c] = true;
        // captures
        var cc1 = c-1, cc2 = c+1, rr = r+dir;
        if (inb(rr,cc1) && board[rr][cc1] && board[rr][cc1].c!==piece.c) out[rr+','+cc1] = true;
        if (inb(rr,cc2) && board[rr][cc2] && board[rr][cc2].c!==piece.c) out[rr+','+cc2] = true;
      } else if (piece.t==='N'){
        var jumps=[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]];
        for (var j=0;j<jumps.length;j++) add(r+jumps[j][0], c+jumps[j][1]);
      } else if (piece.t==='B'){ rays([[1,1],[1,-1],[-1,1],[-1,-1]]); }
      else if (piece.t==='R'){ rays([[1,0],[-1,0],[0,1],[0,-1]]); }
      else if (piece.t==='Q'){ rays([[1,1],[1,-1],[-1,1],[-1,-1],[1,0],[-1,0],[0,1],[0,-1]]); }
      else if (piece.t==='K'){
        for (var dr=-1; dr<=1; dr++)
          for (var dc=-1; dc<=1; dc++)
            if (dr!==0 || dc!==0) add(r+dr,c+dc);
      }
      return out;
    }

    function inb(r,c){ return r>=0 && r<8 && c>=0 && c<8; }

    // Start after DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
