<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chess.com W/L/D Chart</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; background: #0f1420; color: #fff; text-align: center; }
  header { padding: 20px; }
  input, select, button { padding: 6px 10px; margin: 5px; border-radius: 5px; border: none; }
  button { cursor: pointer; background: #5aa9ff; color: white; }
  canvas { max-width: 400px; margin-top: 20px; }
</style>
</head>
<body>
<header>
  <h1>Chess.com Wins/Draws/Losses</h1>
  <input id="username" placeholder="Username" />
  <select id="year"></select>
  <select id="month"></select>
  <button id="load">Load Stats</button>
  <div id="status"></div>
</header>
<canvas id="wldChart"></canvas>

<script>
  const yearSel = document.getElementById("year");
  const monthSel = document.getElementById("month");
  const now = new Date();
  for (let y = now.getFullYear(); y >= now.getFullYear()-5; y--) {
    let opt = document.createElement("option");
    opt.value = y; opt.textContent = y;
    yearSel.appendChild(opt);
  }
  for (let m = 1; m <= 12; m++) {
    let opt = document.createElement("option");
    opt.value = String(m).padStart(2,"0");
    opt.textContent = opt.value;
    monthSel.appendChild(opt);
  }
  yearSel.value = now.getFullYear();
  monthSel.value = String(now.getMonth()+1).padStart(2,"0");

  function gameResult(username, game) {
    const youWhite = game.white.username.toLowerCase() === username.toLowerCase();
    const res = youWhite ? game.white.result : game.black.result;
    if (res === "win") return "win";
    if (["agreed","stalemate","repetition","insufficient","50move","timevsinsufficient"].includes(res)) return "draw";
    return "loss";
  }

  let chart;

  document.getElementById("load").addEventListener("click", async () => {
    const username = document.getElementById("username").value.trim();
    const year = yearSel.value;
    const month = monthSel.value;
    document.getElementById("status").textContent = "Loading...";
    try {
      const url = `https://api.chess.com/pub/player/${encodeURIComponent(username)}/games/${year}/${month}`;
      const res = await fetch(url);
      if (!res.ok) throw new Error("No data");
      const data = await res.json();
      const games = data.games || [];
      if (!games.length) {
        document.getElementById("status").textContent = "No games found.";
        return;
      }
      let win=0, draw=0, loss=0;
      for (const g of games) {
        const r = gameResult(username, g);
        if (r==="win") win++;
        else if (r==="draw") draw++;
        else loss++;
      }
      document.getElementById("status").textContent = `Wins: ${win}, Draws: ${draw}, Losses: ${loss}`;
      if (chart) chart.destroy();
      chart = new Chart(document.getElementById("wldChart"), {
        type: "doughnut",
        data: {
          labels: ["Wins","Draws","Losses"],
          datasets: [{ data: [win, draw, loss], backgroundColor: ["#4caf50","#ffeb3b","#f44336"] }]
        },
        options: { responsive: true }
      });
    } catch (e) {
      document.getElementById("status").textContent = "Error loading stats.";
      console.error(e);
    }
  });
</script>
</body>
</html>
